/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(d,i){var j=this;var e,k;var g,f,c;var h,b;var a="disabled";j.isBusy=false;j.slideNumber=1;j.init=function(){j.element=$(d.slideshow);if(j.element.length){j.slides=j.element.find("."+d.classSlide);if(j.slides.length>1){g=j.element.find(d.buttons);f=g.find(d.buttonNext);c=g.find(d.buttonPrevious);j.slide=j.slides.eq(j.slideNumber-1);j.updateNextPrev();j.initEvents();j.initMarkers();h=setTimeout(j.start,d.delay)}}};j.start=function(){if(!d.isManual){b=setTimeout(function(){j.change()},d.slideTime)}};j.stop=function(){clearTimeout(h);clearTimeout(b)};j.change=function(o,m,l){m=!!m;if(!j.isBusy&&!o||o&&!$(o.target).hasClass("disabled")){var n=j.getNextSlide(m,l);if(j.slide.is(n)){return}j.isBusy=true;j.updateNextPrev();j.updateMarkers();j.transition(n);j.stop();j.callback()}if(!o){j.start()}else{o.preventDefault()}};j.callback=function(){if(typeof i==="function"){i.apply(j)}};j.transition=function(l){l.stop().css("z-index",1).fadeTo(d.slideTimeFade,1);j.slide.stop().css("z-index",0).fadeOut(d.slideTimeFade/2,function(){j.slides.removeClass(d.classActive);l.addClass(d.classActive);j.slide=l;j.isBusy=false})};j.getNextSlide=function(m,l){var n;if(typeof l!=="undefined"){n=j.slides.eq(l);j.slideNumber=l+1}else{n=(m)?j.slide.prev("."+d.classSlide):j.slide.next("."+d.classSlide);j.slideNumber=(m)?j.slideNumber-1:j.slideNumber+1;if(!n.length){if(!d.canLoop){m=!m}n=(m)?j.slides.eq(j.slides.length-1):j.slides.eq(0);j.slideNumber=(m)?j.slides.length:1}}return n};j.updateMarkers=function(m){if(e){var l=j.slideNumber-1;if(m){l=k.index($(this));j.change(m,false,l)}else{k.removeAttr("class").eq(l).addClass(d.classActive)}}};j.updateNextPrev=function(){if(d.canLoop){return}c.removeClass(a);f.removeClass(a);switch(j.slideNumber){case 1:c.addClass(a);break;case j.slides.length:f.addClass(a);break}};j.initMarkers=function(){if(!d.classMarkers){return}e=$("<ul />").addClass(d.classMarkers);for(var m=0,l=j.slides.length;m<l;m++){e.append($('<li><a href="#">'+(m+1)+"</a></li>"))}k=e.find("a");j.element.append(e);j.updateMarkers();k.click(j.updateMarkers);e.show()};j.initEvents=function(){f.bind("click",function(l){j.change(l,false)});c.bind("click",function(l){j.change(l,true)});j.element.bind("mouseenter",j.stop);j.element.bind("mouseleave",j.start)}};