/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(d,h){var c=this;var g,a;var e,f;var b="disabled";c.isBusy=false;c.isBackwards=false;c.slideNumber=1;c.init=function(){c.element=$(d.slideshow);if(c.element.length){c.slides=c.element.find("."+d.classSlide);if(c.slides.length>1){if(d.buttons){c.buttons=c.element.find(d.buttons);c.buttonNext=c.buttons.find(d.buttonNext);c.buttonPrevious=c.buttons.find(d.buttonPrevious)}c.slide=c.slides.eq(c.slideNumber-1);c.updateNextPrev();c.initEvents();c.initMarkers();e=setTimeout(c.start,d.delay)}}};c.start=function(){if(!d.isManual){f=setTimeout(function(){c.change()},d.slideInterval)}};c.stop=function(){clearTimeout(e);clearTimeout(f)};c.change=function(j,i){c.isBackwards=!!(j.data&&j.data.isBackwards);if(!c.isBusy&&(!j||j&&!$(j.target).hasClass("disabled"))){c.getNextSlide(i);if(!c.slide.is(c.slideNext)){c.isBusy=true;c.updateNextPrev();c.updateMarkers();c.transition();c.stop()}}if(!j){c.start()}else{j.preventDefault()}};c.callback=function(){if(typeof h==="function"){h.apply(c)}};c.transition=function(){c.transitionNext();c.transitionCurrent(function(){c.slides.hide().removeClass(d.classActive);c.slideNext.show().addClass(d.classActive);c.slide=c.slideNext;c.isBusy=false;c.callback()})};c.transitionCurrent=function(j){var i=c.slide,k=d.slideTransition;c.slide.stop().css("z-index",0);if(d.isCarousel){i.animate({left:((!c.isBackwards)?"-":"")+c.element.width()+"px"},k,j)}else{k=k/2;i.fadeTo(k,0,j)}};c.transitionNext=function(){var i=c.slideNext,j=d.slideTransition;i.stop().css("z-index",1);if(d.isCarousel){i.css({left:((c.isBackwards)?"-":"")+c.element.width()+"px"}).show().animate({left:"0"},j)}else{i.fadeTo(j,1)}};c.getNextSlide=function(i){if(typeof i!=="undefined"){c.slideNext=c.slides.eq(i);c.slideNumber=i+1}else{c.slideNext=(c.isBackwards)?c.slide.prev("."+d.classSlide):c.slide.next("."+d.classSlide);c.slideNumber=(c.isBackwards)?c.slideNumber-1:c.slideNumber+1;if(!c.slideNext.length){if(!d.canLoop){c.isBackwards=!c.isBackwards}c.slideNext=(c.isBackwards)?c.slides.eq(c.slides.length-1):c.slides.eq(0);c.slideNumber=(c.isBackwards)?c.slides.length:1}}};c.updateMarkers=function(j){if(g){var i=c.slideNumber-1;if(j){i=a.index($(this));c.change(j,false,i)}else{a.removeAttr("class").eq(i).addClass(d.classActive)}}};c.updateNextPrev=function(){if(d.canLoop||!d.buttons){return}c.buttonPrevious.removeClass(b);c.buttonNext.removeClass(b);switch(c.slideNumber){case 1:c.buttonPrevious.addClass(b);break;case c.slides.length:c.buttonNext.addClass(b);break}};c.initMarkers=function(){if(!d.classMarkers){return}g=$("<ul />").addClass(d.classMarkers);for(var l=0,k=c.slides.length;l<k;l++){g.append($('<li><a href="#">'+(l+1)+"</a></li>"))}a=g.find("a");c.element.append(g);c.updateMarkers();a.click(c.updateMarkers);g.show()};c.initEvents=function(){if(d.buttons){c.buttonNext.bind("click",{isBackwards:false},c.change);c.buttonPrevious.bind("click",{isBackwards:true},c.change)}c.element.bind("mouseenter",c.stop);c.element.bind("mouseleave",c.start)}};