/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(d,h){var c=this;var g,a;var e,f;var b="disabled";c.isBusy=false;c.slideNumber=1;c.init=function(){c.element=$(d.slideshow);if(c.element.length){c.slides=c.element.find("."+d.classSlide);if(c.slides.length>1){c.buttons=c.element.find(d.buttons);c.buttonNext=c.buttons.find(d.buttonNext);c.buttonPrevious=c.buttons.find(d.buttonPrevious);c.slide=c.slides.eq(c.slideNumber-1);c.updateNextPrev();c.initEvents();c.initMarkers();e=setTimeout(c.start,d.delay)}}};c.start=function(){if(!d.isManual){f=setTimeout(function(){c.change()},d.slideTime)}};c.stop=function(){clearTimeout(e);clearTimeout(f)};c.change=function(l,j,i){j=!!j;if(!c.isBusy&&!l||l&&!$(l.target).hasClass("disabled")){var k=c.getNextSlide(j,i);if(c.slide.is(k)){return}c.isBusy=true;c.updateNextPrev();c.updateMarkers();c.transition(k);c.stop();c.callback()}if(!l){c.start()}else{l.preventDefault()}};c.callback=function(){if(typeof h==="function"){h.apply(c)}};c.transition=function(i){i.stop().css("z-index",1).fadeTo(d.slideTimeFade,1);c.slide.stop().css("z-index",0).fadeOut(d.slideTimeFade/2,function(){c.slides.removeClass(d.classActive);i.addClass(d.classActive);c.slide=i;c.isBusy=false})};c.getNextSlide=function(j,i){var k;if(typeof i!=="undefined"){k=c.slides.eq(i);c.slideNumber=i+1}else{k=(j)?c.slide.prev("."+d.classSlide):c.slide.next("."+d.classSlide);c.slideNumber=(j)?c.slideNumber-1:c.slideNumber+1;if(!k.length){if(!d.canLoop){j=!j}k=(j)?c.slides.eq(c.slides.length-1):c.slides.eq(0);c.slideNumber=(j)?c.slides.length:1}}return k};c.updateMarkers=function(j){if(g){var i=c.slideNumber-1;if(j){i=a.index($(this));c.change(j,false,i)}else{a.removeAttr("class").eq(i).addClass(d.classActive)}}};c.updateNextPrev=function(){if(d.canLoop){return}c.buttonPrevious.removeClass(b);c.buttonNext.removeClass(b);switch(c.slideNumber){case 1:c.buttonPrevious.addClass(b);break;case c.slides.length:c.buttonNext.addClass(b);break}};c.initMarkers=function(){if(!d.classMarkers){return}g=$("<ul />").addClass(d.classMarkers);for(var l=0,k=c.slides.length;l<k;l++){g.append($('<li><a href="#">'+(l+1)+"</a></li>"))}a=g.find("a");c.element.append(g);c.updateMarkers();a.click(c.updateMarkers);g.show()};c.initEvents=function(){c.buttonNext.bind("click",function(i){c.change(i,false)});c.buttonPrevious.bind("click",function(i){c.change(i,true)});c.element.bind("mouseenter",c.stop);c.element.bind("mouseleave",c.start)}};