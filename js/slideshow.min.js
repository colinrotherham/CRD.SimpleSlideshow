/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(c,h){var i=this;var d,j;var f,e,b;var g,a;i.isBusy=false;i.slideNumber=1;i.init=function(){i.element=$(c.slideshow);if(i.element.length){i.slides=i.element.find("."+c.classSlide);if(i.slides.length>1){f=i.element.find(c.buttons);e=f.find(c.buttonNext);b=f.find(c.buttonPrevious);i.slide=i.slides.eq(i.slideNumber-1);i.initEvents();i.initMarkers();g=setTimeout(i.start,c.delay)}}};i.start=function(){a=setTimeout(function(){i.change()},c.slideTime)};i.stop=function(){clearTimeout(g);clearTimeout(a)};i.change=function(n,l,k){l=!!l;if(!i.isBusy){var m=i.getNextSlide(l,k);if(i.slide.is(m)){return}i.isBusy=true;i.updateMarkers();i.transition(m);i.stop()}if(!n){i.start()}else{n.preventDefault()}i.callback()};i.callback=function(){if(typeof h==="function"){h.apply(i)}};i.transition=function(k){k.stop().css("z-index",1).fadeTo(c.slideTimeFade,1);i.slide.stop().css("z-index",0).fadeOut(c.slideTimeFade/2,function(){i.slides.removeClass(c.classActive);k.addClass(c.classActive);i.slide=k;i.isBusy=false})};i.getNextSlide=function(l,k){var m;if(typeof k!=="undefined"){m=i.slides.eq(k);i.slideNumber=k+1}else{m=(l)?i.slide.prev("."+c.classSlide):i.slide.next("."+c.classSlide);i.slideNumber=(l)?i.slideNumber-1:i.slideNumber+1;if(!m.length){m=(l)?i.slides.eq(i.slides.length-1):i.slides.eq(0);i.slideNumber=(l)?i.slides.length:1}}return m};i.updateMarkers=function(l){if(d){var k=i.slideNumber-1;if(l){k=j.index($(this));i.change(l,false,k)}else{j.removeAttr("class").eq(k).addClass(c.classActive)}}};i.initMarkers=function(){if(!c.classMarkers){return}d=$("<ul />").addClass(c.classMarkers);for(var l=0,k=i.slides.length;l<k;l++){d.append($('<li><a href="#">'+(l+1)+"</a></li>"))}j=d.find("a");i.element.append(d);i.updateMarkers();j.click(i.updateMarkers);d.show()};i.initEvents=function(){e.bind("click",function(k){i.change(k,false)});b.bind("click",function(k){i.change(k,true)});i.element.bind("mouseenter",i.stop);i.element.bind("mouseleave",i.start)}};