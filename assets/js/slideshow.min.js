/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(j,f){var m=this,u={buttonNext:"button.next",buttonPrevious:"button.previous",classStrip:"strip",classSlide:"slide",classActive:"sticky",classMarkers:"markers",classDisabled:"disabled",delay:3000,slideInterval:5000,slideTransition:600,canLoop:true,isManual:false,isCarousel:true},s,b,g,a,v=false,p=false;$.each(j,function(x,y){u[x]=y});function r(){m.element=$(u.slideshow);m.strip=m.element.find("."+u.classStrip);m.slides=m.element.find("."+u.classSlide);if(!m.element.length||m.slides.length<2){return}m.buttonNext=m.element.find(u.buttonNext).show();m.buttonPrevious=m.element.find(u.buttonPrevious).show();m.strip.width((m.slides.length*100)+"%");m.slides.width((100/m.slides.length)+"%");m.slide=m.slides.filter("."+u.classActive);m.slideNumber=m.slides.index(m.slide)+1;if(!m.slide.length){m.slideNumber=1;m.slide=m.slides.eq(m.slideNumber-1).addClass(u.classActive)}o();n();i();w();g=setTimeout(e,u.delay)}function e(){if(!u.isManual){a=setTimeout(function(){k()},u.slideInterval)}}function q(){clearTimeout(g);clearTimeout(a)}function k(A,z){p=!!(A&&A.data&&A.data.isBackwards);var y=$(this);if(!v&&(!A||A&&!y.hasClass(u.classDisabled))){if(y.hasClass(u.classSlide)){if(y.is("a")){return}z=m.slides.index(y)}d(z);if(!m.slide.is(m.slideNext)){v=true;o();l();var B=(u.isCarousel)?u.slideTransition:0;var x=function(){h(A)};t(B,x);q()}}if(!A){e()}else{A.preventDefault()}}function t(y,x){m.strip.animate({left:c()},y,x)}function h(x){m.slides.removeClass(u.classActive);m.slideNext.addClass(u.classActive);m.slide=m.slideNext;v=false;if(x&&x.type==="click"){m.slide.focus()}if(typeof f==="function"){f.call(m)}}function c(){return((m.slideNumber-1)*-100)+"%"}function d(y){var x=m.slide,z=m.slides,B=m.slideNumber,A=z.length;if(typeof y!=="undefined"){x=z.eq(y);B=y+1}else{x=(p)?x.prev("."+u.classSlide):x.next("."+u.classSlide);B=(p)?B-1:B+1;if(!x.length){if(!u.canLoop){p=!p}x=(p)?z.eq(A-1):z.eq(0);B=(p)?A:1}}m.slideNext=x;m.slideNumber=B}function l(y){if(!s){return}var x=m.slideNumber-1;if(y){k(y,b.index(this))}else{b.removeAttr("class").eq(x).addClass(u.classActive)}}function o(){if(u.canLoop){return}m.buttonPrevious.removeClass(u.classDisabled);m.buttonNext.removeClass(u.classDisabled);switch(m.slideNumber){case 1:m.buttonPrevious.addClass(u.classDisabled);break;case m.slides.length:m.buttonNext.addClass(u.classDisabled);break}}function n(){var z=m.slides.length,y;while(z--){y=z*(100/m.slides.length)+"%";m.slides.eq(z).css("left",y).css("display","block").attr("tabindex","-1")}m.strip.css({left:c()})}function w(){if(!u.classMarkers){return}s=$("<ul />").addClass(u.classMarkers);var x=m.slides.length;while(x--){s.prepend($('<li><a href="#" role="button">'+(x+1)+"</a></li>"))}b=s.find("a");m.element.append(s);l();b.click(l);s.show()}function i(){m.buttonNext.bind("click",{isBackwards:false},k);m.buttonPrevious.bind("click",{isBackwards:true},k);m.slides.click(k);m.element.bind("mouseenter",q);m.element.bind("mouseleave",e)}m.init=r;m.start=e;m.stop=q;m.change=k;m.transition=t;m.getTransitionX=c};