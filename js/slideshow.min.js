/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(d,n){var o=this;var e,p;var l,c,b=false,m=false;o.init=function(){o.element=$(d.slideshow);o.strip=o.element.find("."+d.classStrip);o.slides=o.element.find("."+d.classSlide);if(!o.element.length||o.slides.length<2){return}if(d.buttons){o.buttons=o.element.find(d.buttons);o.buttonNext=o.buttons.find(d.buttonNext);o.buttonPrevious=o.buttons.find(d.buttonPrevious)}o.strip.width((o.slides.length*100)+"%");o.slides.width((100/o.slides.length)+"%");o.slide=o.slides.filter("."+d.classActive);o.slideNumber=o.slides.index(o.slide)+1;if(!o.slide.length){o.slideNumber=1;o.slide=o.slides.eq(o.slideNumber-1).addClass(d.classActive)}j();i();k();f();l=setTimeout(o.start,d.delay)};o.start=function(){if(!d.isManual){c=setTimeout(function(){o.change()},d.slideInterval)}};o.stop=function(){clearTimeout(l);clearTimeout(c)};o.change=function(t,s){m=!!(t&&t.data&&t.data.isBackwards);var r=$(this);if(!b&&(!t||t&&!r.hasClass(d.classDisabled))){if(r.hasClass(d.classSlide)){if(r.is("a")){return}s=o.slides.index(r)}g(s);if(!o.slide.is(o.slideNext)){b=true;j();h();var u=(d.isCarousel)?d.slideTransition:0;var q=function(){a(t)};o.transition(u,q);o.stop()}}if(!t){o.start()}else{t.preventDefault()}};o.callback=function(){if(typeof n==="function"){n.call(o)}};o.transition=function(r,q){o.strip.animate({left:o.getTransitionX()},r,q)};o.getTransitionX=function(){return((o.slideNumber-1)*-100)+"%"};function a(q){o.slides.removeClass(d.classActive);o.slideNext.addClass(d.classActive);o.slide=o.slideNext;b=false;if(q&&q.type==="click"){o.slide.focus()}o.callback()}function g(r){var q=o.slide,s=o.slides,u=o.slideNumber,t=s.length;if(typeof r!=="undefined"){q=s.eq(r);u=r+1}else{q=(m)?q.prev("."+d.classSlide):q.next("."+d.classSlide);u=(m)?u-1:u+1;if(!q.length){if(!d.canLoop){m=!m}q=(m)?s.eq(t-1):s.eq(0);u=(m)?t:1}}o.slideNext=q;o.slideNumber=u}function h(r){if(!e){return}var q=o.slideNumber-1;if(r){o.change(r,p.index(this))}else{p.removeAttr("class").eq(q).addClass(d.classActive)}}function j(){if(d.canLoop||!d.buttons){return}o.buttonPrevious.removeClass(d.classDisabled);o.buttonNext.removeClass(d.classDisabled);switch(o.slideNumber){case 1:o.buttonPrevious.addClass(d.classDisabled);break;case o.slides.length:o.buttonNext.addClass(d.classDisabled);break}}function i(){var r=o.slides.length,q;while(r--){q=r*(100/o.slides.length)+"%";o.slides.eq(r).css("left",q).css("display","block").attr("tabindex","-1")}o.strip.css({left:o.getTransitionX()})}function f(){if(!d.classMarkers){return}e=$("<ul />").addClass(d.classMarkers);var q=o.slides.length;while(q--){e.prepend($('<li><a href="#" role="button">'+(q+1)+"</a></li>"))}p=e.find("a");o.element.append(e);h();p.click(h);e.show()}function k(){if(d.buttons){o.buttonNext.bind("click",{isBackwards:false},o.change);o.buttonPrevious.bind("click",{isBackwards:true},o.change)}o.slides.click(o.change);o.element.bind("mouseenter",o.stop);o.element.bind("mouseleave",o.start)}};