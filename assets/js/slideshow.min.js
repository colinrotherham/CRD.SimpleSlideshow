/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};CRD.Slideshow=function(b,o){var p=this,e={buttonNext:"button.next",buttonPrevious:"button.previous",classStrip:"strip",classSlide:"slide",classActive:"sticky",classMarkers:"markers",classDisabled:"disabled",delay:3000,slideInterval:5000,slideTransition:600,canLoop:true,isManual:false,isCarousel:true},f,q,m,d,c=false,n=false;$.each(b,function(r,s){e[r]=s});p.init=function(){p.element=$(e.slideshow);p.strip=p.element.find("."+e.classStrip);p.slides=p.element.find("."+e.classSlide);if(!p.element.length||p.slides.length<2){return}p.buttonNext=p.element.find(e.buttonNext);p.buttonPrevious=p.element.find(e.buttonPrevious);p.strip.width((p.slides.length*100)+"%");p.slides.width((100/p.slides.length)+"%");p.slide=p.slides.filter("."+e.classActive);p.slideNumber=p.slides.index(p.slide)+1;if(!p.slide.length){p.slideNumber=1;p.slide=p.slides.eq(p.slideNumber-1).addClass(e.classActive)}k();j();l();g();m=setTimeout(p.start,e.delay)};p.start=function(){if(!e.isManual){d=setTimeout(function(){p.change()},e.slideInterval)}};p.stop=function(){clearTimeout(m);clearTimeout(d)};p.change=function(u,t){n=!!(u&&u.data&&u.data.isBackwards);var s=$(this);if(!c&&(!u||u&&!s.hasClass(e.classDisabled))){if(s.hasClass(e.classSlide)){if(s.is("a")){return}t=p.slides.index(s)}h(t);if(!p.slide.is(p.slideNext)){c=true;k();i();var v=(e.isCarousel)?e.slideTransition:0;var r=function(){a(u)};p.transition(v,r);p.stop()}}if(!u){p.start()}else{u.preventDefault()}};p.callback=function(){if(typeof o==="function"){o.call(p)}};p.transition=function(s,r){p.strip.animate({left:p.getTransitionX()},s,r)};p.getTransitionX=function(){return((p.slideNumber-1)*-100)+"%"};function a(r){p.slides.removeClass(e.classActive);p.slideNext.addClass(e.classActive);p.slide=p.slideNext;c=false;if(r&&r.type==="click"){p.slide.focus()}p.callback()}function h(s){var r=p.slide,t=p.slides,v=p.slideNumber,u=t.length;if(typeof s!=="undefined"){r=t.eq(s);v=s+1}else{r=(n)?r.prev("."+e.classSlide):r.next("."+e.classSlide);v=(n)?v-1:v+1;if(!r.length){if(!e.canLoop){n=!n}r=(n)?t.eq(u-1):t.eq(0);v=(n)?u:1}}p.slideNext=r;p.slideNumber=v}function i(s){if(!f){return}var r=p.slideNumber-1;if(s){p.change(s,q.index(this))}else{q.removeAttr("class").eq(r).addClass(e.classActive)}}function k(){if(e.canLoop){return}p.buttonPrevious.removeClass(e.classDisabled);p.buttonNext.removeClass(e.classDisabled);switch(p.slideNumber){case 1:p.buttonPrevious.addClass(e.classDisabled);break;case p.slides.length:p.buttonNext.addClass(e.classDisabled);break}}function j(){var s=p.slides.length,r;while(s--){r=s*(100/p.slides.length)+"%";p.slides.eq(s).css("left",r).css("display","block").attr("tabindex","-1")}p.strip.css({left:p.getTransitionX()})}function g(){if(!e.classMarkers){return}f=$("<ul />").addClass(e.classMarkers);var r=p.slides.length;while(r--){f.prepend($('<li><a href="#" role="button">'+(r+1)+"</a></li>"))}q=f.find("a");p.element.append(f);i();q.click(i);f.show()}function l(){p.buttonNext.bind("click",{isBackwards:false},p.change);p.buttonPrevious.bind("click",{isBackwards:true},p.change);p.slides.click(p.change);p.element.bind("mouseenter",p.stop);p.element.bind("mouseleave",p.start)}};